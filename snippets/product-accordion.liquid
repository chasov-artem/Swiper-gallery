{% comment %}
  Dynamic Accordion with Metafields Integration
  Supports multiple open items and empty content validation
{% endcomment %}

{% assign has_metafields = false %}
{% assign metafield_items = 0 %}

{% comment %} Check if we have any metafields set {% endcomment %}
<!-- Debug: All product metafields = {{ product.metafields | json }} -->
<!-- Debug: Custom metafields = {{ product.metafields.custom | json }} -->

{% comment %} Check for existing metafields (11, 12) {% endcomment %}
{% assign details_content = product.metafields.custom.11 %}
{% assign care_content = product.metafields.custom.12 %}

{% if details_content != blank or care_content != blank or model_size != blank %}
  {% assign has_metafields = true %}
{% endif %}

{% comment %} Check for model_s_size metafield {% endcomment %}
{% assign model_size = product.metafields.custom.model_s_size %}
<!-- Debug: model_size = {{ model_size }} -->
<!-- Debug: model_size blank? = {{ model_size | blank }} -->
{% if model_size != blank %}
  {% assign has_metafields = true %}
  {% assign metafield_items = metafield_items | plus: 1 %}
{% endif %}

{% if has_metafields %}
  {% comment %} Use metafields if available {% endcomment %}
  <div class="product-accordion" data-multiple="{{ product.metafields.custom.accordion_multiple | default: 'true' }}">
    
         {% comment %} Render metafield items {% endcomment %}
     
     {% comment %} Details section {% endcomment %}
     {% if details_content != blank %}
       <div class="accordion-item">
         <button class="accordion-header" type="button">
           <span class="accordion-title">Details</span>
           <span class="accordion-icon">+</span>
         </button>
         <div class="accordion-content">
           <div class="accordion-body">{{ details_content }}</div>
         </div>
       </div>
     {% endif %}
     
     {% comment %} Care section {% endcomment %}
     {% if care_content != blank %}
       <div class="accordion-item">
         <button class="accordion-header" type="button">
           <span class="accordion-title">Care</span>
           <span class="accordion-icon">+</span>
         </button>
         <div class="accordion-content">
           <div class="accordion-body">{{ care_content }}</div>
         </div>
       </div>
     {% endif %}
    
                                                                               {% comment %} Add model_s_size if available {% endcomment %}
     {% if model_size != blank %}
       <div class="accordion-item">
         <button class="accordion-header" type="button">
           <span class="accordion-title">Model's size</span>
           <span class="accordion-icon">+</span>
         </button>
         <div class="accordion-content">
           <div class="accordion-body">{{ model_size }}</div>
         </div>
       </div>
     {% endif %}
    
  </div>
{% else %}
  {% comment %} Fallback to hardcoded content {% endcomment %}
  <div class="product-accordion" data-multiple="true">
    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Details</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Professional formula with vitamin E, long-lasting color, does not wash off during the day
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Care</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Store in a cool dry place, close after use
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Size</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Standard lipstick size 3.5g, length 8.5cm
        </div>
      </div>
    </div>
  </div>
{% endif %} 