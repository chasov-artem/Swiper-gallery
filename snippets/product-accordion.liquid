{% comment %}
  Dynamic Accordion with Metafields Integration
  Supports multiple open items and empty content validation
{% endcomment %}

{% assign has_metafields = false %}
{% assign metafield_items = 0 %}

{% comment %} Check if we have any metafields set {% endcomment %}
{% for i in (1..10) %}
  {% assign title_key = 'accordion_title_' | append: i %}
  {% assign content_key = 'accordion_content_' | append: i %}
  {% assign title = product.metafields.custom[title_key] %}
  {% assign content = product.metafields.custom[content_key] %}
  {% if title != blank and content != blank %}
    {% assign has_metafields = true %}
    {% assign metafield_items = metafield_items | plus: 1 %}
  {% endif %}
{% endfor %}

{% comment %} Check for model_size metafield {% endcomment %}
{% assign model_size = product.metafields.custom.model_size %}
{% if model_size != blank %}
  {% assign has_metafields = true %}
  {% assign metafield_items = metafield_items | plus: 1 %}
{% endif %}

{% if has_metafields %}
  {% comment %} Use metafields if available {% endcomment %}
  <div class="product-accordion" data-multiple="{{ product.metafields.custom.accordion_multiple | default: 'true' }}">
    
    {% comment %} Render metafield items {% endcomment %}
    {% for i in (1..10) %}
      {% assign title_key = 'accordion_title_' | append: i %}
      {% assign content_key = 'accordion_content_' | append: i %}
      {% assign title = product.metafields.custom[title_key] %}
      {% assign content = product.metafields.custom[content_key] %}
      
      {% if title != blank and content != blank %}
        <div class="accordion-item">
          <button class="accordion-header" type="button">
            <span class="accordion-title">{{ title }}</span>
            <span class="accordion-icon">+</span>
          </button>
          <div class="accordion-content">
            <div class="accordion-body">{{ content }}</div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
    
    {% comment %} Add model_size if available {% endcomment %}
    {% if model_size != blank %}
      <div class="accordion-item">
        <button class="accordion-header" type="button">
          <span class="accordion-title">Model's size</span>
          <span class="accordion-icon">+</span>
        </button>
        <div class="accordion-content">
          <div class="accordion-body">{{ model_size }}</div>
        </div>
      </div>
    {% endif %}
    
  </div>
{% else %}
  {% comment %} Fallback to hardcoded content {% endcomment %}
  <div class="product-accordion" data-multiple="true">
    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Details</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Professional formula with vitamin E, long-lasting color, does not wash off during the day
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Care</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Store in a cool dry place, close after use
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Size</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Standard lipstick size 3.5g, length 8.5cm
        </div>
      </div>
    </div>
  </div>
{% endif %} 