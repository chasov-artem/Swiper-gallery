{% comment %}
  Dynamic Accordion with Metafields Integration
  Supports multiple open items and empty content validation
{% endcomment %}

{% assign has_metafields = false %}
{% assign metafield_items = 0 %}

{% comment %} Check if we have any metafields set {% endcomment %}

{% comment %} Check for existing metafields {% endcomment %}
{% assign details_content = product.metafields.custom["Details"] %}
{% assign care_content = product.metafields.custom["Care guide"] %}
{% assign size_guide_content = product.metafields.custom["Size guide"] %}

{% if details_content != blank or care_content != blank or size_guide_content != blank %}
  {% assign has_metafields = true %}
{% endif %}


{% if has_metafields %}
  {% comment %} Use metafields if available {% endcomment %}
  <div class="product-accordion" data-multiple="{{ product.metafields.custom.accordion_multiple | default: 'true' }}">
    
         {% comment %} Render metafield items {% endcomment %}
     
           {% comment %} Details section {% endcomment %}
      {% if details_content != blank %}
        <div class="accordion-item">
          <button class="accordion-header" type="button">
            <span class="accordion-title">Details</span>
            <span class="accordion-icon">+</span>
          </button>
          <div class="accordion-content">
            <div class="accordion-body">{{ details_content }}</div>
          </div>
        </div>
      {% endif %}
      
      {% comment %} Care guide section {% endcomment %}
      {% if care_content != blank %}
        <div class="accordion-item">
          <button class="accordion-header" type="button">
            <span class="accordion-title">Care guide</span>
            <span class="accordion-icon">+</span>
          </button>
          <div class="accordion-content">
            <div class="accordion-body">{{ care_content }}</div>
          </div>
        </div>
      {% endif %}
      
      {% comment %} Size guide section {% endcomment %}
      {% if size_guide_content != blank %}
        <div class="accordion-item">
          <button class="accordion-header" type="button">
            <span class="accordion-title">Size guide</span>
            <span class="accordion-icon">+</span>
          </button>
          <div class="accordion-content">
            <div class="accordion-body">{{ size_guide_content }}</div>
          </div>
        </div>
      {% endif %}
    
                                                                               {% comment %} Add model_s_size if available {% endcomment %}
     
    
  </div>
{% else %}
  {% comment %} Fallback to hardcoded content {% endcomment %}
  <div class="product-accordion" data-multiple="true">
    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Details</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Professional formula with vitamin E, long-lasting color, does not wash off during the day
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Care</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Store in a cool dry place, close after use
        </div>
      </div>
    </div>

    <div class="accordion-item">
      <button class="accordion-header" type="button">
        <span class="accordion-title">Size</span>
        <span class="accordion-icon">+</span>
      </button>
      <div class="accordion-content">
        <div class="accordion-body">
          Standard lipstick size 3.5g, length 8.5cm
        </div>
      </div>
    </div>
  </div>
{% endif %} 